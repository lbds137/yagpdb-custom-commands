{{- /*
  Author: Vladlena Costescu (@lbds137)
  Trigger type: `Command`
  Trigger: `atbash`
  Dependencies: `embed_exec`, `gematria`
*/ -}}

{{- $atbashDict := sdict
  "0" "9" "1" "8" "2" "7" "3" "6" "4" "5" "5" "4" "6" "3" "7" "2" "8" "1" "9" "0"
  "×" "×ª" "×‘" "×©" "×’" "×¨" "×“" "×§" "×”" "×¦" "×•" "×¤" "×–" "×¢" "×—" "×¡" "×˜" "× "
  "×™" "×" "×›" "×œ" "×œ" "×›" "×" "×™" "× " "×˜" "×¡" "×—" "×¢" "×–" "×¤" "×•" "×¦" "×”"
  "×§" "×“" "×¨" "×’" "×©" "×‘" "×ª" "×" "×š" "×œ" "×" "×™" "×Ÿ" "×˜" "×£" "×•" "×¥" "×”"
  "ğ¤€" "ğ¤•" "ğ¤" "ğ¤”" "ğ¤‚" "ğ¤“" "ğ¤ƒ" "ğ¤’" "ğ¤„" "ğ¤‘" "ğ¤…" "ğ¤" "ğ¤†" "ğ¤" "ğ¤‡" "ğ¤" "ğ¤ˆ" "ğ¤"
  "ğ¤‰" "ğ¤Œ" "ğ¤Š" "ğ¤‹" "ğ¤‹" "ğ¤Š" "ğ¤Œ" "ğ¤‰" "ğ¤" "ğ¤ˆ" "ğ¤" "ğ¤‡" "ğ¤" "ğ¤†" "ğ¤" "ğ¤…" "ğ¤‘" "ğ¤„"
  "ğ¤’" "ğ¤ƒ" "ğ¤“" "ğ¤‚" "ğ¤”" "ğ¤" "ğ¤•" "ğ¤€"
  "Î‘" "Î©" "Î’" "Î¨" "Î“" "Î§" "Î”" "Î¦" "Î•" "Î¥" "Ïœ" "Ï " "Ïš" "Ï˜" "Î–" "Î¤" "Î—" "Î£" "Î˜" "Î¡"
  "Î™" "Î " "Îš" "ÎŸ" "Î›" "Î" "Îœ" "Î" "Î" "Îœ" "Î" "Î›" "ÎŸ" "Îš" "Î " "Î™" "Ï˜" "Ïš"
  "Î¡" "Î˜" "Î£" "Î—" "Î¤" "Î–" "Î¥" "Î•" "Î¦" "Î”" "Î§" "Î“" "Î¨" "Î’" "Î©" "Î‘" "Ï " "Ïœ"
  "á¾¼" "Î©" "Î†" "Î©" "á¾º" "Î©" "á¼ˆ" "Î©" "á¾ˆ" "Î©" "á¼Œ" "Î©" "á¾Œ" "Î©" "á¼Š" "Î©" "á¾Š" "Î©" "á¼" "Î©"
  "á¾" "Î©" "á¼‰" "Î©" "á¾‰" "Î©" "á¼" "Î©" "á¾" "Î©" "á¼‹" "Î©" "á¾‹" "Î©" "á¼" "Î©" "á¾" "Î©" "á¾¹" "Î©"
  "á¾¸" "Î©" "Îˆ" "Î¥" "á¿ˆ" "Î¥" "á¼˜" "Î¥" "á¼œ" "Î¥" "á¼š" "Î¥" "á¼™" "Î¥" "á¼" "Î¥" "á¼›" "Î¥" "á¿Œ" "Î¥"
  "Î‰" "Î£" "á¿Š" "Î£" "á¼¨" "Î£" "á¾˜" "Î£" "á¼¬" "Î£" "á¾œ" "Î£" "á¼ª" "Î£" "á¾š" "Î£" "á¼®" "Î£" "á¾" "Î£"
  "á¼©" "Î£" "á¾™" "Î£" "á¼­" "Î£" "á¾" "Î£" "á¼«" "Î£" "á¾›" "Î£" "á¼¯" "Î£" "á¾Ÿ" "Î£"
  "ÎŠ" "Î " "á¿š" "Î " "á¼¸" "Î " "á¼¼" "Î " "á¼º" "Î " "á¼¾" "Î " "á¼¹" "Î " "á¼½" "Î " "á¼»" "Î " "á¼¿" "Î "
  "Îª" "Î " "á¿™" "Î " "á¿˜" "Î " "ÎŒ" "Îš" "á¿¸" "Îš" "á½ˆ" "Îš" "á½Œ" "Îš" "á½Š" "Îš" "á½‰" "Îš" "á½" "Îš"
  "á½‹" "Îš"
  "á¿¬" "Î˜" "Î" "Î•" "á¿ª" "Î•" "á½™" "Î•" "á½" "Î•" "á½›" "Î•" "á½Ÿ" "Î•" "Î«" "Î•" "á¿©" "Î•" "á¿¨" "Î•"
  "Î" "Î‘" "á¿º" "Î‘" "á½¨" "Î‘" "á¾¨" "Î‘" "á½¬" "Î‘" "á¾¬" "Î‘" "á½ª" "Î‘" "á¾ª" "Î‘" "á½®" "Î‘" "á¾®" "Î‘"
  "á½©" "Î‘" "á¾©" "Î‘" "á½­" "Î‘" "á¾­" "Î‘" "á½«" "Î‘" "á¾«" "Î‘" "á½¯" "Î‘" "á¾¯" "Î‘"
  "Î±" "Ï‰" "Î²" "Ïˆ" "Î³" "Ï‡" "Î´" "Ï†" "Îµ" "Ï…" "Ï" "Ï¡" "Ï›" "Ï™" "Î¶" "Ï„" "Î·" "Ïƒ" "Î¸" "Ï"
  "Î¹" "Ï€" "Îº" "Î¿" "Î»" "Î¾" "Î¼" "Î½" "Î½" "Î¼" "Î¾" "Î»" "Î¿" "Îº" "Ï€" "Î¹" "Ï™" "Ï›"
  "Ï" "Î¸" "Ïƒ" "Î·" "Ï‚" "Î·" "Ï„" "Î¶" "Ï…" "Îµ" "Ï†" "Î´" "Ï‡" "Î³" "Ïˆ" "Î²" "Ï‰" "Î±" "Ï¡" "Ï"
  "á¾³" "Ï‰" "Î¬" "Ï‰" "á¾´" "Ï‰" "á½°" "Ï‰" "á¾²" "Ï‰" "á¾¶" "Ï‰" "á¾·" "Ï‰" "á¼€" "Ï‰" "á¾€" "Ï‰" "á¼„" "Ï‰"
  "á¾„" "Ï‰" "á¼‚" "Ï‰" "á¾‚" "Ï‰" "á¼†" "Ï‰" "á¾†" "Ï‰" "á¼" "Ï‰" "á¾" "Ï‰" "á¼…" "Ï‰" "á¾…" "Ï‰" "á¼ƒ" "Ï‰"
  "á¾ƒ" "Ï‰" "á¼‡" "Ï‰" "á¾‡" "Ï‰" "á¾±" "Ï‰" "á¾°" "Ï‰" "Î­" "Ï…" "á½²" "Ï…" "á¼" "Ï…" "á¼”" "Ï…" "á¼’" "Ï…"
  "á¼‘" "Ï…" "á¼•" "Ï…" "á¼“" "Ï…" "á¿ƒ" "Ïƒ" "Î®" "Ïƒ" "á¿„" "Ïƒ" "á½´" "Ïƒ" "á¿‚" "Ïƒ" "á¿†" "Ïƒ" "á¿‡" "Ïƒ"
  "á¼ " "Ïƒ" "á¾" "Ïƒ" "á¼¤" "Ïƒ" "á¾”" "Ïƒ" "á¼¢" "Ïƒ" "á¾’" "Ïƒ" "á¼¦" "Ïƒ" "á¾–" "Ïƒ" "á¼¡" "Ïƒ" "á¾‘" "Ïƒ"
  "á¼¥" "Ïƒ" "á¾•" "Ïƒ" "á¼£" "Ïƒ" "á¾“" "Ïƒ" "á¼§" "Ïƒ" "á¾—" "Ïƒ"
  "Î¯" "Ï€" "á½¶" "Ï€" "á¿–" "Ï€" "á¼°" "Ï€" "á¼´" "Ï€" "á¼²" "Ï€" "á¼¶" "Ï€" "á¼±" "Ï€" "á¼µ" "Ï€" "á¼³" "Ï€"
  "á¼·" "Ï€" "ÏŠ" "Ï€" "Î" "Ï€" "á¿’" "Ï€" "á¿—" "Ï€" "á¿‘" "Ï€" "á¿" "Ï€" "ÏŒ" "Îº" "á½¸" "Îº" "á½€" "Îº"
  "á½„" "Îº" "á½‚" "Îº" "á½" "Îº" "á½…" "Îº" "á½ƒ" "Îº"
  "á¿¤" "Î¸" "á¿¥" "Î¸" "Ï" "Îµ" "á½º" "Îµ" "á¿¦" "Îµ" "á½" "Îµ" "á½”" "Îµ" "á½’" "Îµ" "á½–" "Îµ" "á½‘" "Îµ"
  "á½•" "Îµ" "á½“" "Îµ" "á½—" "Îµ" "Ï‹" "Îµ" "Î°" "Îµ" "á¿¢" "Îµ" "á¿§" "Îµ" "á¿¡" "Îµ" "á¿ " "Îµ" "á¿³" "Î±"
  "Ï" "Î±" "á¿´" "Î±" "á½¼" "Î±" "á¿²" "Î±" "á¿¶" "Î±" "á¿·" "Î±" "á½ " "Î±" "á¾ " "Î±" "á½¤" "Î±" "á¾¤" "Î±"
  "á½¢" "Î±" "á¾¢" "Î±" "á½¦" "Î±" "á¾¦" "Î±" "á½¡" "Î±" "á¾¡" "Î±" "á½¥" "Î±" "á¾¥" "Î±" "á½£" "Î±" "á¾£" "Î±"
  "á½§" "Î±" "á¾§" "Î±"
  "Ø§" "Øº" "Ø¨" "Ø¸" "Ø¬" "Ø¶" "Ø¯" "Ø°" "Ù‡" "Ø®" "Ø©" "Ø®" "Ùˆ" "Ø«" "Ø²" "Øª" "Ø­" "Ø´" "Ø·" "Ø±"
  "ÙŠ" "Ù‚" "Ùƒ" "Øµ" "Ù„" "Ù" "Ù…" "Ø¹" "Ù†" "Ø³" "Ø³" "Ù†" "Ø¹" "Ù…" "Ù" "Ù„" "Øµ" "Ùƒ"
  "Ù‚" "ÙŠ" "Ø±" "Ø·" "Ø´" "Ø­" "Øª" "Ø²" "Ø«" "Ùˆ" "Ø®" "Ù‡" "Ø°" "Ø¯" "Ø¶" "Ø¬" "Ø¸" "Ø¨"
  "Øº" "Ø§"
  "Ù‰" "Øº" "Ø¢" "Øº" "Ø£" "Øº" "Ø¥" "Øº" "Ù¾" "Ø¸" "Ú†" "Ø¶" "Ø¤" "Ø«" "Ú˜" "Øª"
  "Ø¦" "Ù‚" "Ú¯" "Øµ"
  "A" "Z" "B" "Y" "C" "X" "D" "W" "E" "V" "F" "U" "G" "T" "H" "S" "I" "R"
  "K" "P" "L" "O" "M" "N" "N" "M" "O" "L" "P" "K" "Q" "J" "R" "I" "S" "H"
  "T" "G" "U" "F" "X" "C" "Y" "B" "Z" "A" "J" "Q" "V" "E" "W" "D"
  "a" "z" "b" "y" "c" "x" "d" "w" "e" "v" "f" "u" "g" "t" "h" "s" "i" "r"
  "k" "p" "l" "o" "m" "n" "n" "m" "o" "l" "p" "k" "q" "j" "r" "i" "s" "h"
  "t" "g" "u" "f" "x" "c" "y" "b" "z" "a" "j" "q" "v" "e" "w" "d"
  "Ä‚" "Z" "Ã‚" "Z" "Ã€" "Z" "Ã‚" "Z" "Ã‡" "X" "Ã‰" "V" "Ãˆ" "V" "ÃŠ" "V" "Ã‹" "V" "Ã†" "ZV"
  "Ã" "R" "Ã" "R"
  "Ã‘" "M" "Ã”" "L" "Å’" "LV" "È˜" "H"
  "Èš" "G" "Ã™" "F" "Ã›" "F" "Ãœ" "F" "Å¸" "B"
  "Äƒ" "z" "Ã¢" "z" "Ã " "z" "Ã¢" "z" "Ã§" "x" "Ã©" "v" "Ã¨" "v" "Ãª" "v" "Ã«" "v" "Ã¦" "zv"
  "Ã®" "r" "Ã¯" "r"
  "Ã±" "m" "Ã´" "l" "Å“" "lv" "È™" "h"
  "È›" "g" "Ã¹" "f" "Ã»" "f" "Ã¼" "f" "Ã¿" "b"
  "áš " "á›Ÿ" "áš¢" "á›" "áš¦" "á›œ" "áš¨" "á›š" "áš±" "á›—" "áš²" "á›–" "áš·" "á›’" "áš¹" "á›" "ášº" "á›Š"
  "áš¾" "á›‰" "á›" "á›ˆ" "á›ƒ" "á›‡" "á›‡" "á›ƒ" "á›ˆ" "á›" "á›‰" "áš¾" "á›Š" "ášº" "á›" "áš¹" "á›’" "áš·"
  "á›–" "áš²" "á›—" "áš±" "á›š" "áš¨" "á›œ" "áš¦" "á›" "áš¢" "á›Ÿ" "áš "
  "áš¡" "á›Ÿ" "áš£" "á›" "áš¤" "á›" "áš¥" "á›" "áš§" "á›œ" "áš©" "á›š" "ášª" "á›š" "áš«" "á›š" "áš¬" "á›š" "áš­" "á›š"
  "áš®" "á›š" "áš¯" "á›š" "áš°" "á›š" "áš³" "á›–" "áš´" "á›–" "ášµ" "á›–" "áš¶" "á›–" "áš¸" "á›’" "áš»" "á›Š" "áš¼" "á›Š"
  "áš½" "á›Š" "áš¿" "á›‰" "á›€" "á›‰" "á›‚" "á›ˆ" "á›„" "á›‡" "á›…" "á›‡" "á›†" "á›‡" "á›¡" "á›‡" "á›¦" "áš¾" "á›§" "áš¾"
  "á›¨" "áš¾" "á›‹" "ášº" "á›Œ" "ášº" "á›" "ášº" "á›" "ášº" "á›" "áš¹" "á›‘" "áš¹" "á› " "áš¹" "á›“" "áš·" "á›”" "áš·"
  "á›•" "áš·" "á›˜" "áš±" "á›™" "áš±" "á››" "áš¨" "á›" "áš¦" -}}

{{ $globalDict := (dbGet 0 "Global").Value }}
{{ $deleteTriggerDelay := toInt ($globalDict.Get "Delete Trigger Delay") }}

{{ $gematriaDict := (dbGet 0 "Gematria").Value }}
{{ $sofitDict := $gematriaDict.Get "Final Letters" }}

{{ $commandsDict := (dbGet 0 "Commands").Value }}
{{ $embed_exec := toInt ($commandsDict.Get "embed_exec") }}
{{ $gematria := toInt ($commandsDict.Get "gematria") }}

{{ $channelsDict := (dbGet 0 "Channels").Value }}
{{ $yagpdbChannelID := toInt ($channelsDict.Get "YAGPDB") }}

{{- $args := parseArgs 1 "Usage: [text from which to generate atbash]"
  (carg "string" "text") -}}
{{- $text := $args.Get 0 -}}

{{- $atbashString := "" -}}
{{- $words := reSplit "[[:space:]]+" $text }}
{{- $spaces := reSplit "[^[:space:]]+" $text }}
{{- range $i, $word := $words -}}
  {{- $atbashWord := "" -}}
  {{- $wordChars := split $word "" }}
  {{- $wordLength := len $wordChars -}}
  {{- range $j, $char := $wordChars -}}
    {{- $atbashLetter := index $atbashDict $char -}}
    {{- if $atbashLetter -}}
      {{- if and (gt $wordLength 1) (eq $j (sub $wordLength 1)) -}}
        {{- $sofitLetter := index $sofitDict $atbashLetter -}}
        {{- if $sofitLetter }}
          {{- $atbashLetter = $sofitLetter -}}
        {{- end -}}
      {{- end -}}
    {{- else -}}
      {{- $atbashLetter = $char -}}
    {{- end -}}
    {{- $atbashWord = joinStr "" $atbashWord $atbashLetter -}}
  {{- end -}}
  {{- $atbashString = joinStr (index $spaces $i) $atbashString $atbashWord -}}
{{- end -}}

{{ execCC $gematria $yagpdbChannelID 0 (sdict
  "AuthorID" .User.ID
  "ChannelID" .Channel.ID
  "Title" "Atbash Ciphertext"
  "Description" $atbashString
  "Fields" (cslice (sdict "name" "Plaintext" "value" $text "inline" false))
) }}

{{ deleteTrigger $deleteTriggerDelay }}
