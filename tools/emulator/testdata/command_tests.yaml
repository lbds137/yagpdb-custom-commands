name: "Command Integration Tests"
description: "Tests for utility and staff_utility commands that require arguments"

defaults:
  user:
    id: 987654321098765432
    username: "TestUser"
    discriminator: "0001"
  channel:
    id: 123456789012345678
    name: "test-channel"
  guild:
    id: 111222333444555666
    name: "Test Server"

# Common database setup for all tests
setup_db:
  - user_id: 0
    key: "Global"
    value:
      Delete Trigger Delay: 5
      Delete Response Delay: 10
      ExecCC Limit: 10
  - user_id: 0
    key: "Commands"
    value:
      embed_exec: 123
      gematria: 124
      message_link: 125
      db_get_embed: 126
      db_get_text: 127
  - user_id: 0
    key: "Channels"
    value:
      YAGPDB: 999999999
      Introduction: 888888888
      Introduction Archive: 777777777
      Welcome: 666666666
      Admission Log: 555555555
  - user_id: 0
    key: "Roles"
    value:
      Staff: 111111111
      Guest: 222222222
      Member: 333333333
      Minor: 444444444
      Adult: 555555555
  - user_id: 0
    key: "Admin"
    value:
      Welcome Message: "Welcome to the server!"
  - user_id: 0
    key: "Gematria"
    value:
      Values:
        # Hebrew letters
        א: 1
        ב: 2
        ג: 3
        ד: 4
        ה: 5
        ו: 6
        ז: 7
        ח: 8
        ט: 9
        י: 10
        כ: 20
        ך: 20
        ל: 30
        מ: 40
        ם: 40
        נ: 50
        ן: 50
        ס: 60
        ע: 70
        פ: 80
        ף: 80
        צ: 90
        ץ: 90
        ק: 100
        ר: 200
        ש: 300
        ת: 400
        # Latin letters (English Qabalah style)
        a: 1
        b: 2
        c: 3
        d: 4
        e: 5
        f: 6
        g: 7
        h: 8
        i: 9
        j: 600
        k: 10
        l: 20
        m: 30
        n: 40
        o: 50
        p: 60
        q: 70
        r: 80
        s: 90
        t: 100
        u: 200
        v: 700
        w: 900
        x: 300
        y: 400
        z: 500
      Final Letters:
        א: א
        ב: ב
        ג: ג
        ד: ד
        ה: ה
        ו: ו
        ז: ז
        ח: ח
        ט: ט
        י: י
        כ: ך
        ל: ל
        מ: ם
        נ: ן
        ס: ס
        ע: ע
        פ: ף
        צ: ץ
        ק: ק
        ר: ר
        ש: ש
        ת: ת
      Tarot Indices:
        "1": 0
        "2": 1
        "3": 2
        "4": 3
        "5": 4
        "6": 5
        "7": 6
        "8": 7
        "9": 8
        "10": 9
        "20": 10
        "30": 11
        "40": 12
        "50": 13
        "60": 14
        "70": 15
        "80": 16
        "90": 17
        "100": 18
        "200": 19
        "300": 20
        "400": 21
      RWS Names:
        "0": "The Fool"
        "1": "The Magician"
        "2": "The High Priestess"
        "3": "The Empress"
        "4": "The Emperor"
        "5": "The Hierophant"
        "6": "The Lovers"
        "7": "The Chariot"
        "8": "Strength"
        "9": "The Hermit"
        "10": "The Wheel of Fortune"
        "11": "Justice"
        "12": "The Hanged Man"
        "13": "Death"
        "14": "Temperance"
        "15": "The Devil"
        "16": "The Tower"
        "17": "The Star"
        "18": "The Moon"
        "19": "The Sun"
        "20": "Judgement"
        "21": "The World"
  - user_id: 0
    key: "Rules"
    value:
      "Rule #1": "Be respectful to all members."
      "Rule #2": "No spamming or flooding the chat."
      "Rule #3": "Keep discussions on topic."
  - user_id: 0
    key: "Knowledge"
    value:
      FAQ: "This is the FAQ content."
      Guidelines: "These are the guidelines."
  - user_id: 0
    key: "Directory"
    value:
      Exclude Categories:
        - "Staff Only"
        - "Bot Commands"
        - "Archive"
      Show Empty: false
      Show NSFW: false

command_map:
  123: "templates/mock_embed_exec.gohtml"
  124: "templates/mock_gematria.gohtml"
  125: "templates/mock_message_link.gohtml"
  126: "templates/mock_db_get_embed.gohtml"
  127: "templates/mock_db_get_text.gohtml"

tests:
  # ===== Utility Commands =====

  - name: "alefbet - Hebrew text conversion"
    template: "../../../utility/alefbet.gohtml"
    context:
      args: ["שלום"]
      cmd_args: ["שלום"]

  - name: "alefbet - Arabic to Hebrew"
    template: "../../../utility/alefbet.gohtml"
    context:
      args: ["سلام"]
      cmd_args: ["سلام"]

  - name: "atbash - Basic cipher"
    template: "../../../utility/atbash.gohtml"
    context:
      args: ["אבגד"]
      cmd_args: ["אבגד"]

  - name: "contrast - Valid hex color"
    template: "../../../utility/contrast.gohtml"
    context:
      args: ["#FF5500"]
      cmd_args: ["#FF5500"]

  - name: "contrast - Hex without hash"
    template: "../../../utility/contrast.gohtml"
    context:
      args: ["00FF00"]
      cmd_args: ["00FF00"]

  - name: "contrast - Role ID"
    template: "../../../utility/contrast.gohtml"
    context:
      args: ["111111111111111111"]
      cmd_args: ["111111111111111111"]

  - name: "contrasts - Multiple colors"
    template: "../../../utility/contrasts.gohtml"
    context:
      args: ["FF0000 00FF00 0000FF"]
      cmd_args: ["FF0000 00FF00 0000FF"]

  - name: "gematria - Hebrew word"
    template: "../../../utility/gematria.gohtml"
    context:
      args: ["אמת"]
      cmd_args: ["אמת"]

  - name: "gematria - English text"
    template: "../../../utility/gematria.gohtml"
    context:
      args: ["hello"]
      cmd_args: ["hello"]

  - name: "hugemoji - Discord custom emoji"
    template: "../../../utility/hugemoji.gohtml"
    context:
      args: ["<:test:123456789012345678>"]
      cmd_args: ["<:test:123456789012345678>"]

  - name: "hugemoji - Animated emoji"
    template: "../../../utility/hugemoji.gohtml"
    context:
      args: ["<a:dance:987654321098765432>"]
      cmd_args: ["<a:dance:987654321098765432>"]

  - name: "kb - Knowledge base lookup"
    template: "../../../utility/kb.gohtml"
    context:
      args: ["FAQ"]
      cmd_args: ["FAQ"]

  - name: "message_pointer - Valid message link"
    template: "../../../utility/message_pointer.gohtml"
    context:
      args: ["https://discord.com/channels/111222333444555666/123456789012345678/999888777666555444"]
      cmd_args: ["https://discord.com/channels/111222333444555666/123456789012345678/999888777666555444"]

  - name: "pyramid - Simple text"
    template: "../../../utility/pyramid.gohtml"
    context:
      args: ["hello"]
      cmd_args: ["hello"]

  - name: "rand_hebrew - Generate random letters"
    template: "../../../utility/rand_hebrew.gohtml"
    context:
      args: ["5"]
      cmd_args: ["5"]

  - name: "rule - View rule 1"
    template: "../../../utility/rule.gohtml"
    context:
      args: ["1"]
      cmd_args: ["1"]

  - name: "rule - View rule 2"
    template: "../../../utility/rule.gohtml"
    context:
      args: ["2"]
      cmd_args: ["2"]

  # ===== Staff Utility Commands =====

  - name: "admit_user - Admit with message link"
    template: "../../../staff_utility/admit_user.gohtml"
    context:
      args: ["https://discord.com/channels/111222333444555666/888888888/123123123123123123", "adult"]
      cmd_args: ["https://discord.com/channels/111222333444555666/888888888/123123123123123123", "adult"]

  - name: "archive - Archive channel"
    template: "../../../staff_utility/archive.gohtml"
    context:
      args: ["test-archive"]
      cmd_args: ["test-archive"]

  - name: "bootstrap - Initialize with command IDs"
    template: "../../../staff_utility/bootstrap.gohtml"
    context:
      args: ["123", "127", "111111111"]
      cmd_args: ["123", "127", "111111111"]

  - name: "guest - Guest user processing"
    template: "../../../staff_utility/guest.gohtml"
    context:
      args: ["https://discord.com/channels/111222333444555666/888888888/456456456456456456"]
      cmd_args: ["https://discord.com/channels/111222333444555666/888888888/456456456456456456"]

  - name: "inactivity - Check user inactivity"
    template: "../../../staff_utility/inactivity.gohtml"
    context:
      args: ["30"]
      cmd_args: ["30"]

  - name: "reject_user - Reject with message link"
    template: "../../../staff_utility/reject_user.gohtml"
    context:
      args: ["https://discord.com/channels/111222333444555666/888888888/789789789789789789", "Did not meet requirements"]
      cmd_args: ["https://discord.com/channels/111222333444555666/888888888/789789789789789789", "Did not meet requirements"]

  - name: "role_ping - Ping a role"
    template: "../../../staff_utility/role_ping.gohtml"
    context:
      args: ["111111111", "Important announcement!"]
      cmd_args: ["111111111", "Important announcement!"]

  - name: "rule_edit - Edit a rule"
    template: "../../../staff_utility/rule_edit.gohtml"
    context:
      args: ["1", "Updated rule text here."]
      cmd_args: ["1", "Updated rule text here."]

  - name: "screen_user - Screen user for admission"
    template: "../../../staff_utility/screen_user.gohtml"
    context:
      args: ["https://discord.com/channels/111222333444555666/888888888/321321321321321321", "Suspicious activity"]
      cmd_args: ["https://discord.com/channels/111222333444555666/888888888/321321321321321321", "Suspicious activity"]

  - name: "simple_db_lookup - Lookup knowledge entry"
    template: "../../../staff_utility/simple_db_lookup.gohtml"
    context:
      args: ["Knowledge", "FAQ"]
      cmd_args: ["Knowledge", "FAQ"]

  - name: "simple_db_edit - Edit knowledge entry"
    template: "../../../staff_utility/simple_db_edit.gohtml"
    context:
      args: ["Knowledge", "FAQ", "Updated FAQ content"]
      cmd_args: ["Knowledge", "FAQ", "Updated FAQ content"]

  # ===== Database Dump =====

  - name: "db dump - Dump all keys"
    template: "../../../utility/db.gohtml"
    context:
      args: ["dump"]
      cmd_args: ["dump"]

  - name: "db dump - Dump specific key"
    template: "../../../utility/db.gohtml"
    context:
      args: ["dump", "Global"]
      cmd_args: ["dump", "Global"]

  # ===== Database Add (Array Append) =====

  - name: "db add - Append to array via nested key"
    template: "../../../utility/db.gohtml"
    context:
      args: ["add", "Directory:Exclude Categories", "New Category"]
      cmd_args: ["add", "Directory:Exclude Categories", "New Category"]

  - name: "db get - Verify array contents"
    template: "../../../utility/db.gohtml"
    context:
      args: ["get", "Directory:Exclude Categories"]
      cmd_args: ["get", "Directory:Exclude Categories"]
